
# 스프링의 강의 리뷰📽
> LoadMap Part : 스프링 MVC 패턴 1편   
> Section : 05.스프링 MVC - 구조 이해  
> CreateDate : 2022.07. 21 
> UpdateDate :

### 목차
 - [스프링 MVC 전체 구조](#TheWholeStructure) 
 - [핸들러 매핑과 핸들러 어댑터](#MappingAndAdapter) 
 - [뷰 리졸버](#)
 - 스프링 MVC 
   - 시작하기 
   - 컨트롤러 통합
   - 실용적인 방식
<br></br>
### IntelliJ 단축키 및 구현
- `해당 클래스에서 마우스 오른쪽버튼` -> `Diagram` -> `Show Diagram` : 클래스간 상속관계를 알 수 있다. (UML버전)
<br></br>
<br></br>

# 1.스프링 MVC 전체 구조<a name="TheWholeStructure"></a>
> 직접만든 MVC 구조와 Spring이 지원하는 MVC 구조를 비교해보자 

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179978379-d97a1bc1-ee4f-469f-a289-cd43e1bb06e2.png" width="80%"></p>

 - 기본적인 아키텍처 구조는 동일하다. 
 - 주요하게 다른 부분은 글자색을 변경하였는데 변경된 부분은 아래와 같다. 
   - **FrontController -> DispatcherServlet**
   - handlerMappingMap -> HandlerMapping
   - MyHandlerAdapter -> HandlerAdapter
   - ModelView -> ModelAndView
   - viewResolver -> ViewResolver
   - MyView  -> View

## DispatcherServlet 
 - `org.springframework.web.servlet.DispatcherServlet`
   - 이전 섹션 참고자료 참고  
 - 스프링 MVC의 프론트컨트롤러가 디스패처 서블릿이다.(스프링MVC의 핵심)


### 서블릿 등록 
 - `DispacherServlet`도 부모 클래스에서 `HttpServlet`을 상속 받아서 사용하고, 서블릿으로 동작한다
     <p align="center"><img src="https://user-images.githubusercontent.com/104331549/179981678-79a10de5-18d9-4a88-ae1e-9d45f7d7280d.png" width="80%"></p>
 - 스프링 부트는 디스패처서블릿을 내장 톰캣을 띄우면서 자동으로 등록한다.(`@WebServlet(urlPatterns="")`과는 다른 방식의 등록)
   - 그래서 이 서블릿은 모든 경로(`urlPatterns="/"`)에 대해서 매핑한다.
   - 프론트 컨트롤러의 역할 
   - 더 자세한 경로의 우선순위가 높기때문에, 기존에 등록한 서블릿도 함께 동작한다.

### 요청 흐름
 - 서블릿이 호출되면 `HttpServlet` 이 제공하는 `serivce()` 가 호출된다
 - 스프링 MVC는 `DispatcherServlet` 의 부모인 `FrameworkServlet`에서 `service()` 를 `@Override` 해두었다.
 - `FrameworkServlet.service()` 를 시작으로 여러 메서드가 호출되면서 `DispacherServlet.doDispatch()` 가 호출된다
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179983970-f3398e69-372a-4ad7-bbba-4121d1555f69.png" ></p>


### DispacherServlet.doDispatch()
 - 디스패처서블릿의 핵심인 doDispatch()코드를 보자 
    - 예외처리, 인터셉터 기능은 제외했다. 
```java
public class dispacherServlet {
   //생략
   protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
      HttpServletRequest processedRequest = request;
      HandlerExecutionChain mappedHandler = null;
      ModelAndView mv = null;

      // 1. 핸들러 조회
      mappedHandler = getHandler(processedRequest);
      if (mappedHandler == null) {
         noHandlerFound(processedRequest, response);
         return;
      }
      // 2. 핸들러 어댑터 조회 - 핸들러를 처리할 수 있는 어댑터
      HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());
      // 3. 핸들러 어댑터 실행 -> 4. 핸들러 어댑터를 통해 핸들러 실행 -> 5. ModelAndView 반환
      mv = ha.handle(processedRequest, response, mappedHandler.getHandler());
      processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);
   }

   private void processDispatchResult(HttpServletRequest request,
                                      HttpServletResponse response,
                                      HandlerExecutionChain mappedHandler,
                                      ModelAndView mv,
                                      Exception exception
   ) throws Exception {
      // 뷰 렌더링 호출
      render(mv, request, response);
   }

   protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception {
      View view;
      String viewName = mv.getViewName();
      // 6. 뷰 리졸버를 통해서 뷰 찾기, 7. View 반환
      view = resolveViewName(viewName, mv.getModelInternal(), locale, request);
      // 8. 뷰 렌더링
      view.render(mv.getModelInternal(), request, response);
   }
}
```

## 주요 인터페이스 목록
 - 아래 인터페이스들은 전부 `org.springframework.web.servlet.*` 디렉토리에 있다.
   - 핸들러 매핑: `HandlerMapping`
   - 핸들러 어댑터: `HandlerAdapter`
   - 뷰 리졸버: `ViewResolver`
   - 뷰: `View`

> 스프링 MVC는 코드 분량도 매우 많고, 복잡해서 내부 구조를 다 파악하는 것은 쉽지 않다.   
> 사실 해당 기능을 직접 확장하거나 나만의 컨트롤러를 만드는 일은 없다. 왜냐하면 대부분의 기능이 이미 다 구현되어 있다.  
 - 그래도 이렇게 핵심동작을 알아두어야 향후 문제가 발생했을때, 어떤 부분에서 **문제**가 발생했는지 쉽게 **파악**할 수 있다.
 - 또한, 확장 포인트가 필요할 때도, 어떤 부분을 **확장**해야할 지 **파악** 할 수가 있다.

<br></br>
<br></br>

# 핸들러 매핑과 핸들러 어댑터<a name="MappingAndAdapter"></a>


### 과거버전 스프링 컨트롤러 
- org.springframework.web.servlet.mvc.Controller
  - 인터페이스이며, 요청과 응답을 인자로 받고, `ModelAndView`를 반환한다.
  - Controller 인터페이스는 @Controller 애노테이션과는 전혀 다르다.
```java
public interface Controller {
        ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception;
    }
```


<p align="center"><img src="" width="80%"></p>


<a name=""></a>
<br></br>
<br></br>

## 느낀점 😌

### 참고 링크

