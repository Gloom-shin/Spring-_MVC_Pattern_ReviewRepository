
# μ¤ν”„λ§μ κ°•μ λ¦¬λ·°π“½
> LoadMap Part : μ¤ν”„λ§ MVC ν¨ν„΄ 1νΈ   
> Section : 05.μ¤ν”„λ§ MVC - κµ¬μ΅° μ΄ν•΄  
> CreateDate : 2022.07. 21 
> UpdateDate :

### λ©μ°¨
 - [μ¤ν”„λ§ MVC μ „μ²΄ κµ¬μ΅°](#TheWholeStructure) 
 - [ν•Έλ“¤λ¬ λ§¤ν•‘κ³Ό ν•Έλ“¤λ¬ μ–΄λ‘ν„°](#MappingAndAdapter) 
 - [λ·° λ¦¬μ΅Έλ²„](#)
 - μ¤ν”„λ§ MVC 
   - μ‹μ‘ν•κΈ° 
   - μ»¨νΈλ΅¤λ¬ ν†µν•©
   - μ‹¤μ©μ μΈ λ°©μ‹
<br></br>
### IntelliJ λ‹¨μ¶•ν‚¤ λ° κµ¬ν„
- `ν•΄λ‹Ή ν΄λμ¤μ—μ„ λ§μ°μ¤ μ¤λ¥Έμ½λ²„νΌ` -> `Diagram` -> `Show Diagram` : ν΄λμ¤κ°„ μƒμ†κ΄€κ³„λ¥Ό μ• μ μλ‹¤. (UMLλ²„μ „)
<br></br>
<br></br>

# 1.μ¤ν”„λ§ MVC μ „μ²΄ κµ¬μ΅°<a name="TheWholeStructure"></a>
> μ§μ ‘λ§λ“  MVC κµ¬μ΅°μ™€ Springμ΄ μ§€μ›ν•λ” MVC κµ¬μ΅°λ¥Ό λΉ„κµν•΄λ³΄μ 

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179978379-d97a1bc1-ee4f-469f-a289-cd43e1bb06e2.png" width="80%"></p>

 - κΈ°λ³Έμ μΈ μ•„ν‚¤ν…μ² κµ¬μ΅°λ” λ™μΌν•λ‹¤. 
 - μ£Όμ”ν•κ² λ‹¤λ¥Έ λ¶€λ¶„μ€ κΈ€μμƒ‰μ„ λ³€κ²½ν•μ€λ”λ° λ³€κ²½λ λ¶€λ¶„μ€ μ•„λμ™€ κ°™λ‹¤. 
   - **FrontController -> DispatcherServlet**
   - handlerMappingMap -> HandlerMapping
   - MyHandlerAdapter -> HandlerAdapter
   - ModelView -> ModelAndView
   - viewResolver -> ViewResolver
   - MyView  -> View

## DispatcherServlet 
 - `org.springframework.web.servlet.DispatcherServlet`
   - μ΄μ „ μ„Ήμ… μ°Έκ³ μλ£ μ°Έκ³   
 - μ¤ν”„λ§ MVCμ ν”„λ΅ νΈμ»¨νΈλ΅¤λ¬κ°€ λ””μ¤ν¨μ² μ„λΈ”λ¦Ώμ΄λ‹¤.(μ¤ν”„λ§MVCμ ν•µμ‹¬)


### μ„λΈ”λ¦Ώ λ“±λ΅ 
 - `DispacherServlet`λ„ λ¶€λ¨ ν΄λμ¤μ—μ„ `HttpServlet`μ„ μƒμ† λ°›μ•„μ„ μ‚¬μ©ν•κ³ , μ„λΈ”λ¦ΏμΌλ΅ λ™μ‘ν•λ‹¤
     <p align="center"><img src="https://user-images.githubusercontent.com/104331549/179981678-79a10de5-18d9-4a88-ae1e-9d45f7d7280d.png" width="80%"></p>
 - μ¤ν”„λ§ λ¶€νΈλ” λ””μ¤ν¨μ²μ„λΈ”λ¦Ώμ„ λ‚΄μ¥ ν†°μΊ£μ„ λ„μ°λ©΄μ„ μλ™μΌλ΅ λ“±λ΅ν•λ‹¤.(`@WebServlet(urlPatterns="")`κ³Όλ” λ‹¤λ¥Έ λ°©μ‹μ λ“±λ΅)
   - κ·Έλμ„ μ΄ μ„λΈ”λ¦Ώμ€ λ¨λ“  κ²½λ΅(`urlPatterns="/"`)μ— λ€ν•΄μ„ λ§¤ν•‘ν•λ‹¤.
   - ν”„λ΅ νΈ μ»¨νΈλ΅¤λ¬μ μ—­ν•  
   - λ” μμ„Έν• κ²½λ΅μ μ°μ„ μμ„κ°€ λ†’κΈ°λ•λ¬Έμ—, κΈ°μ΅΄μ— λ“±λ΅ν• μ„λΈ”λ¦Ώλ„ ν•¨κ» λ™μ‘ν•λ‹¤.

### μ”μ²­ νλ¦„
 - μ„λΈ”λ¦Ώμ΄ νΈμ¶λλ©΄ `HttpServlet` μ΄ μ κ³µν•λ” `serivce()` κ°€ νΈμ¶λλ‹¤
 - μ¤ν”„λ§ MVCλ” `DispatcherServlet` μ λ¶€λ¨μΈ `FrameworkServlet`μ—μ„ `service()` λ¥Ό `@Override` ν•΄λ‘μ—λ‹¤.
 - `FrameworkServlet.service()` λ¥Ό μ‹μ‘μΌλ΅ μ—¬λ¬ λ©”μ„λ“κ°€ νΈμ¶λλ©΄μ„ `DispacherServlet.doDispatch()` κ°€ νΈμ¶λλ‹¤
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179983970-f3398e69-372a-4ad7-bbba-4121d1555f69.png" ></p>


### DispacherServlet.doDispatch()
 - λ””μ¤ν¨μ²μ„λΈ”λ¦Ώμ ν•µμ‹¬μΈ doDispatch()μ½”λ“λ¥Ό λ³΄μ 
    - μμ™Έμ²λ¦¬, μΈν„°μ…‰ν„° κΈ°λ¥μ€ μ μ™Έν–λ‹¤. 
```java
public class dispacherServlet {
   //μƒλµ
   protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception {
      HttpServletRequest processedRequest = request;
      HandlerExecutionChain mappedHandler = null;
      ModelAndView mv = null;

      // 1. ν•Έλ“¤λ¬ μ΅°ν
      mappedHandler = getHandler(processedRequest);
      if (mappedHandler == null) {
         noHandlerFound(processedRequest, response);
         return;
      }
      // 2. ν•Έλ“¤λ¬ μ–΄λ‘ν„° μ΅°ν - ν•Έλ“¤λ¬λ¥Ό μ²λ¦¬ν•  μ μλ” μ–΄λ‘ν„°
      HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());
      // 3. ν•Έλ“¤λ¬ μ–΄λ‘ν„° μ‹¤ν–‰ -> 4. ν•Έλ“¤λ¬ μ–΄λ‘ν„°λ¥Ό ν†µν•΄ ν•Έλ“¤λ¬ μ‹¤ν–‰ -> 5. ModelAndView λ°ν™
      mv = ha.handle(processedRequest, response, mappedHandler.getHandler());
      processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);
   }

   private void processDispatchResult(HttpServletRequest request,
                                      HttpServletResponse response,
                                      HandlerExecutionChain mappedHandler,
                                      ModelAndView mv,
                                      Exception exception
   ) throws Exception {
      // λ·° λ λ”λ§ νΈμ¶
      render(mv, request, response);
   }

   protected void render(ModelAndView mv, HttpServletRequest request, HttpServletResponse response) throws Exception {
      View view;
      String viewName = mv.getViewName();
      // 6. λ·° λ¦¬μ΅Έλ²„λ¥Ό ν†µν•΄μ„ λ·° μ°ΎκΈ°, 7. View λ°ν™
      view = resolveViewName(viewName, mv.getModelInternal(), locale, request);
      // 8. λ·° λ λ”λ§
      view.render(mv.getModelInternal(), request, response);
   }
}
```

## μ£Όμ” μΈν„°νμ΄μ¤ λ©λ΅
 - μ•„λ μΈν„°νμ΄μ¤λ“¤μ€ μ „λ¶€ `org.springframework.web.servlet.*` λ””λ ‰ν† λ¦¬μ— μλ‹¤.
   - ν•Έλ“¤λ¬ λ§¤ν•‘: `HandlerMapping`
   - ν•Έλ“¤λ¬ μ–΄λ‘ν„°: `HandlerAdapter`
   - λ·° λ¦¬μ΅Έλ²„: `ViewResolver`
   - λ·°: `View`

> μ¤ν”„λ§ MVCλ” μ½”λ“ λ¶„λ‰λ„ λ§¤μ° λ§κ³ , λ³µμ΅ν•΄μ„ λ‚΄λ¶€ κµ¬μ΅°λ¥Ό λ‹¤ νμ•…ν•λ” κ²ƒμ€ μ‰½μ§€ μ•λ‹¤.   
> μ‚¬μ‹¤ ν•΄λ‹Ή κΈ°λ¥μ„ μ§μ ‘ ν™•μ¥ν•κ±°λ‚ λ‚λ§μ μ»¨νΈλ΅¤λ¬λ¥Ό λ§λ“λ” μΌμ€ μ—†λ‹¤. μ™λƒν•λ©΄ λ€λ¶€λ¶„μ κΈ°λ¥μ΄ μ΄λ―Έ λ‹¤ κµ¬ν„λμ–΄ μλ‹¤.  
 - κ·Έλλ„ μ΄λ ‡κ² ν•µμ‹¬λ™μ‘μ„ μ•μ•„λ‘μ–΄μ•Ό ν–¥ν›„ λ¬Έμ κ°€ λ°μƒν–μ„λ•, μ–΄λ–¤ λ¶€λ¶„μ—μ„ **λ¬Έμ **κ°€ λ°μƒν–λ”μ§€ μ‰½κ² **νμ•…**ν•  μ μλ‹¤.
 - λν•, ν™•μ¥ ν¬μΈνΈκ°€ ν•„μ”ν•  λ•λ„, μ–΄λ–¤ λ¶€λ¶„μ„ **ν™•μ¥**ν•΄μ•Όν•  μ§€ **νμ•…** ν•  μκ°€ μλ‹¤.

<br></br>
<br></br>

# ν•Έλ“¤λ¬ λ§¤ν•‘κ³Ό ν•Έλ“¤λ¬ μ–΄λ‘ν„°<a name="MappingAndAdapter"></a>


### κ³Όκ±°λ²„μ „ μ¤ν”„λ§ μ»¨νΈλ΅¤λ¬ 
- org.springframework.web.servlet.mvc.Controller
  - μΈν„°νμ΄μ¤μ΄λ©°, μ”μ²­κ³Ό μ‘λ‹µμ„ μΈμλ΅ λ°›κ³ , `ModelAndView`λ¥Ό λ°ν™ν•λ‹¤.
  - Controller μΈν„°νμ΄μ¤λ” @Controller μ• λ…Έν…μ΄μ…κ³Όλ” μ „ν€ λ‹¤λ¥΄λ‹¤.
```java
public interface Controller {
        ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception;
    }
```
 
### OldController
```java
@Component("/springmvc/old-controller")
public class OldController implements Controller {
    @Override
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        System.out.println("OldController.handleRequest");
        return null;
    }
}
```
- μ‹¤ν–‰ν•κ³ , `http://localhost:8080/springmvc/old-controller`μ— μ ‘μ†ν•λ©΄, μ„ λ¬Έμ¥μ΄ μ¶λ ¥λλ‹¤.

> μ–΄λ–»κ² μ΄ μ»¨νΈλ΅¤λ¬κ°€ νΈμ¶λλ” κ²ƒμΌκΉ? 

<br></br>
## OldController νΈμ¶
- `@Component` : μ΄ μ»¨νΈλ΅¤λ¬λ” /springmvc/old-controller λΌλ” μ΄λ¦„μ μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅λμ—λ‹¤.
  - λΉμ μ΄λ¦„μΌλ΅ URLμ„ λ§¤ν•‘ν•  κ²ƒμ΄λ‹¤

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/179998515-1d84d399-9cc4-4b4e-8ac6-1ebf4b45f3e4.png" width="50%"></p>

### HandlerMapping(ν•Έλ“¤λ¬ λ§¤ν•‘)
 - ν•Έλ“¤λ¬ λ§¤ν•‘μ—μ„ μ΄ μ»¨νΈλ΅¤λ¬λ¥Ό μ°Ύμ„ μ μμ–΄μ•Ό ν•λ‹¤
   - μ¤ν”„λ§ λΉμ μ΄λ¦„μΌλ΅ ν•Έλ“¤λ¬λ¥Ό μ°Ύμ„ μ μλ” ν•Έλ“¤λ¬ λ§¤ν•‘μ΄ ν•„μ”ν•λ‹¤.
   - Springμ€ μ΄λ―Έ κµ¬ν„λμ–΄ μμ–΄, λΉ μ΄λ¦„μΌλ΅ ν•΄λ‹Ή ν•Έλ“¤λ¬λ¥Ό μ°Ύμ„ μ μλ‹¤.
### HandlerAdapter(ν•Έλ“¤λ¬ μ–΄λ‘ν„°)
 - ν•Έλ“¤λ¬ λ§¤ν•‘μ„ ν†µν•΄μ„ μ°Ύμ€ ν•Έλ“¤λ¬λ¥Ό μ‹¤ν–‰ν•  μ μλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„°κ°€ ν•„μ”ν•λ‹¤.
   - `Controller` μΈν„°νμ΄μ¤λ¥Ό μ‹¤ν–‰ν•  μ μλ” ν•Έλ“¤λ¬ μ–΄λ‘ν„°λ¥Ό μ°Ύκ³  μ‹¤ν–‰ν•΄μ•Ό ν•λ‹¤.
   - Springμ€ μ΄λ―Έ κµ¬ν„λμ–΄ μμ–΄, ν•΄λ‹Ή μ–΄λ‘ν„°λ¥Ό μ°Ύμ•„ μ‹¤ν–‰μ‹ν‚¬ μ μλ‹¤.

<br></br>

## μ¤ν”„λ§ λ¶€νΈκ°€ **μλ™ λ“±λ΅**ν•λ” ν•Έλ“¤λ¬ λ§¤ν•‘κ³Ό ν•Έλ“¤λ¬ μ–΄λ‘ν„°

### HandlerMapping
```text
0 = RequestMappingHandlerMapping : μ• λ…Έν…μ΄μ… κΈ°λ°μ μ»¨νΈλ΅¤λ¬μΈ @RequestMappingμ—μ„ μ‚¬μ© (@RestController)
1 = BeanNameUrlHandlerMapping : μ¤ν”„λ§ λΉμ μ΄λ¦„μΌλ΅ ν•Έλ“¤λ¬λ¥Ό μ°Ύλ”λ‹¤.
```
### HandlerAdapter
```text
0 = RequestMappingHandlerAdapter : μ• λ…Έν…μ΄μ… κΈ°λ°μ μ»¨νΈλ΅¤λ¬μΈ @RequestMappingμ—μ„ μ‚¬μ© (@RestController)
1 = HttpRequestHandlerAdapter : HttpRequestHandler μ²λ¦¬
2 = SimpleControllerHandlerAdapter : Controller μΈν„°νμ΄μ¤(μ• λ…Έν…μ΄μ…X, κ³Όκ±°μ— μ‚¬μ©) μ²λ¦¬ 
```

## μ •λ¦¬ν•μλ©΄
> OldController λ¥Ό μ‹¤ν–‰ν•λ©΄μ„ μ‚¬μ©λ κ°μ²΄λ” λ‹¤μκ³Ό κ°™λ‹¤.
 - `HandlerMapping` = 1. `BeanNameUrlHandlerMapping`
 - `HandlerAdapter` = 2. `SimpleControllerHandlerAdapter`


<p align="center"><img src="" width="80%"></p>


<a name=""></a>
<br></br>
<br></br>

## λλ‚€μ  π

### μ°Έκ³  λ§ν¬

