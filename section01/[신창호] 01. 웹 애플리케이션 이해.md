
# 스프링의 강의 리뷰📽
> LoadMap Part : 스프링 MVC 패턴 1편   
> Section :  01
> CreateDate : 2022.07.  
> UpdateDate :

### 목차
- [웹 서버, 웹 애플리케이션 서버](#WebServerWAS)
- [서블릿](#Servlet)
- 동시 요청 - 멀티 쓰레드
- HTML, HTTP API, CSR, SSR
- 자바 백엔드 웹 기술 역사

<br></br>
<br></br>

# 1.웹 서버, 웹 애플리케이션 서버<a name="WebServerWAS"></a>

> 웹 세상에서는 HTTP 메시지를 기반으로 모든 것을 전송한다.   
> 서버간의 데이터를 주고 받을 때도 HTTP를 이용.

## 웹 서버(Web Server) 
 - HTTP 기반으로 동작
 - 정적 리소스 제공, 기타 부가기능
 - 정적(파일) HTML, CSS, JS, 이미지, 영상
    - 대표적으로 Apache, Nginx [웹서버 잠깐 알아보기](https://bentist.tistory.com/80)

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178115686-0b7d02a8-ab2a-4b64-a332-b72c07922fef.png" width="80%"></p>


## 웹 애플리케이션 서버(WAS
- HTTP 기반으로 동작
- 웹 서버 기능 포함 + (정적 리소스 제공 가능)
- 프로그램 코드를 실행해서 애플리케이션 로직 수행 
  - 사용자에 따라 다른 UI를 제공해 줄 수 있다
  - 동적 HTML, HTTP API(JSON)
  - 서블릿, JSP, 스프링 MVC
    - 대표적으로 **톰캣(Tomcat)**, Jetty, Undertow

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178116039-8be6bd05-aa67-4a6a-88fd-fc2d31a7bd6e.png" width="80%"></p>

## 차이점 
> 사실 둘의 용어도 경계도 모호하다.   
> 왜냐하면, 웹서버도 프로그램을 실행하는 기능을 포함하기도 하고, 웹 애플리케이션 서버도 웹 서버의 기능을 제공하기도 하기 때문이다.  
> 그래도, 명시적으로 차이점을 나타내자면 아래와 같다.

 - 웹서버: 정적 리소스 파일

 - WAS : 동적 애플리케이션 로직
   - 자바는 서블릿 컨테이너 기능을 제공하면 WAS
   - 서블릿 없이 자바코드를 실행하는 서버 프레임워크도 있음
     - 찾아보니 스프링 리액티브(Spring WebFlux)
     - [Spring 리액티브개념 참고링크](https://jogeum.net/30) 
   - WAS는 **애플리케이션 코드를 실행**하는데 더 특화 됨.
   

## 최소한의 웹 시스템 구성 
> WAS 와 DB 
 - 정적 리소스, 애플리케이션 로직을 모두 제공해주는 WAS와 DB 구성으로 웹 시스템을 구축할 수는 있다.

### 한계점
 - WAS가 너무 많은 역할을 하기에, **서버 과부화** 우려가 있다.
 - 가장 비싼 애플리케이션 로직이 정적리소스 때문에 수행이 어려울 수 있다.
   - 주문하는 로직이 이미지불러오는 로직때문에, 수행하기 어려워짐.
 - WAS가 생각보다 잘 죽는데, 이경우는 오류화면도 노출 불가능하다.
   - 프론트서버가 있으면, 인위적인 오류화면을 띄울수 있다. 
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178116450-a49cd1ed-ee5c-491c-bc28-846144ec71c5.png" width="60%"></p>

## 현재 웹 시스템 구성 
> WEB , WAS 와 DB
 - 웹서버 : 정적 리소스를 따로 처리하며, 동적인 처리는 WAS에 요청
 - WAS : 중요한 애플리케이션 로직 처리

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178116643-056e855f-e294-4798-9c79-acb5368b1ee3.png" width="80%"></p>

> 이로써, 효율적인 리소스 관리가 가능해진다.  
> 정적리소스가 필요하면, 웹서버 증설  
> 애플리케이션 리소스가 필요하면, WAS 증설  

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178116726-bb4a7c57-82c2-4e88-b2d4-860aa2b89fae.png" width="80%"></p>

### 장점 
 - 정적리소스만 제공하는 웹 서버는 잘 죽지않음 
 - 그래서 잘 죽는 WAS가 장애시, 웹 서버가 오류 화면을 제공해줄 수 있다.

> 정적리소스를 캐시할 수 있는 중간 서버 CDN이라는 것도 있다.
 - [쿠팡 물류창고같은 CDN서버에 대해서](https://www.cloudflare.com/ko-kr/learning/cdn/what-is-a-cdn/)

<br></br>
<br></br>

# 2. 서블릿<a name="Servlet"></a>

### 서블릿이 하는 일 

<p align="center"><img src="https://user-images.githubusercontent.com/104331549/178117312-7bff580f-be50-43b2-8097-483c9b990722.png" width="70%"></p>


### 서블릿 내부 코드

```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello") 
public class HelloServlet extends HttpServlet { 
 @Override 
 protected void service(HttpServletRequest request, HttpServletResponse response){  
 //애플리케이션 로직
 } 
}
```
 - urlPatterns(/hello)의 URL이 호출되면 서블릿 코드가 실행
 - HTTP **요청 정보**를 편리하게 사용할 수 있는 `HttpServletRequest`
 - HTTP **응답 정보**를 편리하게 제공할 수 있는 `HttpServletResponse`
 - HTTP 스펙은 알고 써야한다.  

> 한가지 의문점이 든다.   
> request의 경우, 요청이니까 객체가 만들어져 있지만, response의 경우는 응답이기 때문에, 애플리케이션 로직이 완료되어야지만 생기는 것이 아닐까?
 - 스프링이 좋아하는 정보가 비어진 객체를 만드는 방식으로 해결한다.
 - 매 요청마다, 요청객체와 응답객체를 새로 만들어 준다.
 - [해답 링크](https://www.inflearn.com/questions/187064)

<br></br>

## 서블릿 컨테이너
 - 톰캣처럼 서블릿을 지원하는 WAS를 서블릿 컨테이너라고 함
 - 서블릿 컨테이너는 서블릿 객체를 생성, 초기화, 호출, 종료하는 **생명주기 관리**
 - 서블릿 객체는 싱글톤으로 관리
   - 고객의 요청이 올 때 마다 계속 객체를 생성하는 것은 비효율
   - 최초 로딩 시점에 서블릿 객체를 미리 만들어두고 재활용
   - 모든 고객 요청은 동일한 서블릿 객체 인스턴스에 접근
   - **공유 변수 사용 주의**
   - 서블릿 컨테이너 종료시 함께 종료
 - JSP도 서블릿으로 변환 되어서 사용
   - JSP는 쉽게말해, HTML 코드에 JAVA코드도 들어갈 수 있는 파일[나무위치 참조](https://namu.wiki/w/JSP)
 - **동시 요청을 위한 멀티 쓰레드 처리 지원**

> 동시요청 멀티 쓰레드가 뭐길래 중요한 걸까?

<br></br>
<br></br>

# 3. 동시 요청 - 멀티 쓰레드<a name=""></a>
> 백엔드 개발자에게 매우 중요한 PART
 - 서블릿 객체를 누가 호출하지?

## 쓰레드
- 애플리케이션 코드를 하나하나 순차적으로 실행하는 것은 쓰레드
- 자바 메인 메서드를 처음 실행하면 main이라는 이름의 쓰레드가 실행
- 쓰레드가 없다면 자바 애플리케이션 실행이 불가능
- 쓰레드는 한번에 하나의 코드 라인만 수행
- 동시 처리가 필요하면 쓰레드를 추가로 생성

### 요청 마다 쓰레드 생성
장단점
- 장점
  - 동시 요청을 처리할 수 있다.
  - 리소스(CPU, 메모리)가 허용할 때 까지 처리가능
  - 하나의 쓰레드가 지연 되어도, 나머지 쓰레드는 정상 동작한다.
- 단점
  - 쓰레드는 생성 비용은 매우 비싸다.
  - 고객의 요청이 올 때 마다 쓰레드를 생성하면, 응답 속도가 늦어진다.
  - 쓰레드는 컨텍스트 스위칭 비용이 발생한다.
  - 쓰레드 생성에 제한이 없다.
  - 고객 요청이 너무 많이 오면, CPU, 메모리 임계점을 넘어서 서버가 죽을 수 있다


### 쓰레드 풀
> 요청 마다 쓰레드 생성의 단점 보완
- 특징
  - 필요한 쓰레드를 쓰레드 풀에 보관하고 관리한다.
  - 쓰레드 풀에 생성 가능한 쓰레드의 최대치를 관리한다. 톰캣은 최대 200개 기본 설정 (변경 가능)
- 사용
  - 쓰레드가 필요하면, 이미 생성되어 있는 쓰레드를 쓰레드 풀에서 꺼내서 사용한다.
  - 사용을 종료하면 쓰레드 풀에 해당 쓰레드를 반납한다.
  - 최대 쓰레드가 모두 사용중이어서 쓰레드 풀에 쓰레드가 없으면?
    - 기다리는 요청은 거절하거나 특정 숫자만큼만 대기하도록 설정할 수 있다.
- 장점
  - 쓰레드가 미리 생성되어 있으므로, 쓰레드를 생성하고 종료하는 비용(CPU)이 절약되고, 응답 시간이 빠르다.
  - 생성 가능한 쓰레드의 최대치가 있으므로 너무 많은 요청이 들어와도 기존 요청은 안전하게 처리할 수 있다




<br></br>
<br></br>

# 4. HTML, HTTP API, CSR, SSR<a name=""></a>
<br></br>
<br></br>

# 5. - 자바 백엔드 웹 기술 역사<a name=""></a>


<p align="center"><img src="" width="80%"></p>



<br></br>
<br></br>

## 느낀점 😌

### 참고 링크

